<html>

<head>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
  <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <title>Healthshare</title>
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
      height: 100%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    #pac-input {
      background-color: #fff;
      font-family: Roboto;
      font-size: 15px;
      font-weight: 300;
      margin-left: 12px;
      padding: 0 11px 0 13px;
      text-overflow: ellipsis;
      width: 400px;
      position: fixed;
      bottom: 0;
      left: 0;
    }

    #pac-input:focus {
      border-color: #4d90fe;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <script>
    var customLabel = {
      medical: {
        label: 'M'
      },
      company: {
        label: 'C'
      }
    };

    $.ajax({
      type: 'get',
      url: 'http://localhost:5000/mapPoints',
      crossDomain: true,
      dataType: 'json',
      headers: {
        "Access-Control-Allow-Origin": "*"
      },
      success: function (json, textStatus, jqXHR) {
        function initMap() {
          var map = new google.maps.Map(document.getElementById('map'), {
            center: new google.maps.LatLng(51.282757, 10.495068),
            zoom: 7
          });
          var infoWindow = new google.maps.InfoWindow;

          for (i = 0; i < json.length; i++) {
            var icon = customLabel[json[i].type] || {};
            var marker = new google.maps.Marker({
              map: map,
              position: new google.maps.LatLng(parseFloat(json[i].lat), parseFloat(json[i].lng)),
              label: icon.label
            });

            google.maps.event.addListener(marker, 'click', (function (marker, i) {
              return function () {

                var infowincontent = null;

                var infowincontent = document.createElement('div');
                var strong = document.createElement('strong');
                strong.textContent = json[i].name;
                infowincontent.appendChild(strong);
                infowincontent.appendChild(document.createElement('br'));

                var text = document.createElement('text');
                text.textContent = json[i].address;
                infowincontent.appendChild(text);

                if (json[i].market == "demand") {
                  infowincontent.appendChild(text);
                  var text = document.createElement('p');
                  text.textContent = "Wir benÃ¶tigen " +
                    json[i].disinfectant + " Liter Desinfektionsmittel, " +
                    json[i].gloves + " Paar Handschuhe und " +
                    json[i].masks + " Schutzmasken!";
                  infowincontent.appendChild(text);

                } else if (json[i].market == "supply") {
                  var supply = document.createElement('p');
                  demand.textContent = "Wir bieten " +
                    json[i].disinfectant + " Liter Desinfektionsmittel, " +
                    json[i].gloves + " Paar Handschuhe und " +
                    json[i].masks + " Schutzmasken!";

                  var link = "localhost:5000/delivery/" + json[i].id;
                  var btn = document.createElement('button');
                  btn.textContent = 'JETZT HELFEN!';
                  btn.addEventListener("click", function () {
                    location = link; // Navigate to new page
                  });
                  infowincontent.appendChild(btn);

                  infoWindow.setContent(infowincontent);
                  infoWindow.open(map, marker);

                }
              }
            })(marker, i));
          }

          // Create the search box and link it to the UI element.
          var input = document.getElementById('pac-input');
          var searchBox = new google.maps.places.SearchBox(input);
          map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);

          // Bias the SearchBox results towards current map's viewport.
          map.addListener('bounds_changed', function () {
            searchBox.setBounds(map.getBounds());
          });

          var markers = [];
          // Listen for the event fired when the user selects a prediction and retrieve
          // more details for that place.
          searchBox.addListener('places_changed', function () {
            var places = searchBox.getPlaces();

            if (places.length == 0) {
              return;
            }

            map.fitBounds(bounds);
          });
        }},
        error: function (responseData, textStatus, errorThrown) {
          console.warn(responseData, textStatus, errorThrown);
          alert('CORS failed - ' + textStatus);
        }
      });
  </script>
  <!-- Replace the value of the key parameter with your own API key. -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAa2q4wDgv2bikmWv7fEgt1j66wJjltQYQ&callback=initMap">
    </script>
  <input id="pac-input" class="controls" type="text" placeholder="Wo kannst du helfen?">
</body>

</html>